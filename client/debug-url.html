<!DOCTYPE html>
<html>
<head>
    <title>QR Code URL Debug</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        .debug-box { background: white; padding: 20px; border-radius: 8px; margin: 10px 0; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; }
        code { background: #f8f9fa; padding: 2px 4px; border-radius: 3px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>QR Code URL Debug</h1>
    
    <div class="debug-box info">
        <h3>Current URL Information:</h3>
        <p><strong>Full URL:</strong> <code id="fullUrl"></code></p>
        <p><strong>Search Params:</strong> <code id="searchParams"></code></p>
        <p><strong>Pair Code:</strong> <code id="pairCode"></code></p>
        <p><strong>Timestamp:</strong> <code id="timestamp"></code></p>
    </div>
    
    <div class="debug-box" id="resultBox">
        <h3>Detection Result:</h3>
        <p id="resultText">Checking...</p>
    </div>
    
    <div class="debug-box">
        <h3>Test URLs:</h3>
        <p><a href="?pair=TEST123" target="_blank">Simple Test: ?pair=TEST123</a></p>
        <p><a href="?pair=978756&t=1752346069450" target="_blank">Current QR: ?pair=978756&t=1752346069450</a></p>
    </div>
    
    <script>
        function updateDebugInfo() {
            const fullUrl = window.location.href;
            const searchParams = window.location.search;
            const urlParams = new URLSearchParams(searchParams);
            const pairCode = urlParams.get('pair');
            const timestamp = urlParams.get('t');
            
            document.getElementById('fullUrl').textContent = fullUrl;
            document.getElementById('searchParams').textContent = searchParams || '(none)';
            document.getElementById('pairCode').textContent = pairCode || '(none)';
            document.getElementById('timestamp').textContent = timestamp || '(none)';
            
            const resultBox = document.getElementById('resultBox');
            const resultText = document.getElementById('resultText');
            
            if (pairCode) {
                resultBox.className = 'debug-box success';
                resultText.innerHTML = `<strong>SUCCESS!</strong> QR code detected: ${pairCode}`;
                
                // Show what should happen
                setTimeout(() => {
                    resultText.innerHTML += '<br><br>✓ Should join room: pair-' + pairCode;
                    resultText.innerHTML += '<br>✓ Should show "QR Code Detected!" message';
                    resultText.innerHTML += '<br>✓ Should automatically connect to pairing room';
                }, 1000);
            } else {
                resultBox.className = 'debug-box error';
                resultText.innerHTML = '<strong>NO PAIR CODE FOUND</strong><br>URL parameters not detected or processed correctly.';
            }
        }
        
        // Update immediately and on URL changes
        updateDebugInfo();
        window.addEventListener('popstate', updateDebugInfo);
        
        // Update every 500ms for the first 3 seconds to catch any timing issues
        let updateCount = 0;
        const intervalId = setInterval(() => {
            updateCount++;
            updateDebugInfo();
            
            if (updateCount >= 6) {
                clearInterval(intervalId);
            }
        }, 500);
    </script>
</body>
</html>